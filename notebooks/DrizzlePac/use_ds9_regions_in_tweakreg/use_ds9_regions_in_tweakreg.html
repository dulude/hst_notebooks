
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Using DS9 Regions to Include and Exclude Sources in HST Image Alignment with TWEAKREG &#8212; STScI Notebooks</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" href="../../../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/main.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/clipboard.min.js"></script>
    <script src="../../../_static/copybutton.js"></script>
    <script src="../../../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../../../_static/logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">STScI Notebooks</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../../index.html">
                    <no title>
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  DrizzlePac
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../Initialization/Initialization.html">
   DrizzlePac Initialization
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  NICMOS
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../NICMOS/nicmos_unit_conversion/nicmos_unit_conversion.html">
   Programmatic Replacements for NICMOS Units Conversion Form
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="github.com/dulude/notebooks_migration"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="github.com/dulude/notebooks_migration/issues/new?title=Issue%20on%20page%20%2Fnotebooks/DrizzlePac/use_ds9_regions_in_tweakreg/use_ds9_regions_in_tweakreg.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../../../_sources/notebooks/DrizzlePac/use_ds9_regions_in_tweakreg/use_ds9_regions_in_tweakreg.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   Using DS9 Regions to Include and Exclude Sources in HST Image Alignment with TWEAKREG
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#introduction">
     Introduction
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#download-the-data">
     1. Download the data
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#use-tweakreg-to-create-source-catalogs">
     2. Use TweakReg to create source catalogs
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#ds9-regions-in-tweakreg">
     3. DS9 Regions in TweakReg
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#exclusion-regions">
     4. Exclusion regions
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#inclusion-regions">
     5. Inclusion Regions
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#combining-exclusion-and-inclusion-regions">
     6. Combining Exclusion and Inclusion Regions
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#about-this-notebook">
   About this Notebook
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Using DS9 Regions to Include and Exclude Sources in HST Image Alignment with TWEAKREG</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   Using DS9 Regions to Include and Exclude Sources in HST Image Alignment with TWEAKREG
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#introduction">
     Introduction
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#download-the-data">
     1. Download the data
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#use-tweakreg-to-create-source-catalogs">
     2. Use TweakReg to create source catalogs
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#ds9-regions-in-tweakreg">
     3. DS9 Regions in TweakReg
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#exclusion-regions">
     4. Exclusion regions
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#inclusion-regions">
     5. Inclusion Regions
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#combining-exclusion-and-inclusion-regions">
     6. Combining Exclusion and Inclusion Regions
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#about-this-notebook">
   About this Notebook
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="using-ds9-regions-to-include-and-exclude-sources-in-hst-image-alignment-with-tweakreg">
<h1>Using DS9 Regions to Include and Exclude Sources in HST Image Alignment with TWEAKREG<a class="headerlink" href="#using-ds9-regions-to-include-and-exclude-sources-in-hst-image-alignment-with-tweakreg" title="Permalink to this headline">#</a></h1>
<div class="alert-danger">Note: The notebook in this repository 'Initializtion.ipynb' goes over many of the basic concepts such as the setup of the environment/package installation and should be read first if you are new to HST images, DrizzlePac, or Astroquery.</div>
<p><a id='top'></a></p>
<section id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">#</a></h2>
<p>DS9 is a popular <a class="reference external" href="http://ds9.si.edu/site/Home.html">image visualization program</a> used in astronomy. It is now a standard package in the <a class="reference external" href="https://astroconda.readthedocs.io/en/latest/">AstroConda channel</a>. DS9 regions are interactive, user generated shapes which mark areas of interest. <a class="reference external" href="http://ds9.si.edu/doc/ref/region.html">Here is documentation</a> about DS9 regions. For users with no experience with DS9, many resources exist online. One example is <a class="reference external" href="https://astrobites.org/2011/03/09/how-to-use-sao-ds9-to-examine-astronomical-images/">this AstroBites page</a> which summarizes the most common DS9 features.</p>
<p>In this example we show how <a class="reference external" href="https://drizzlepac.readthedocs.io/en/latest/tweakreg.html">TweakReg</a> can include and exclude sources identified by DS9 regions during image alignment. The use of “excluded” regions prevents spurious detections and ignores parts of the input images that might trouble a proper identification of sources for alignment. “Included” regions is particularly useful for images that have few good sources that can be used for image alignment and need all other sources not contained within these regions to be ignored.</p>
<p>This notebook is based on a <a class="reference external" href="http://www.stsci.edu/hst/HST_overview/drizzlepac/examples/example10">prior example</a> available from the <a class="reference external" href="http://www.stsci.edu/hst/HST_overview/drizzlepac">DrizzlePac webpage</a>. Please direct inquires about this notebook, DrizzlePac, or any other issues with HST images to the <a class="reference external" href="https://stsci.service-now.com/hst">HST help desk</a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># import all packages</span>
<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">shutil</span>

<span class="kn">from</span> <span class="nn">astropy.table</span> <span class="kn">import</span> <span class="n">Table</span>
<span class="kn">from</span> <span class="nn">astropy.io</span> <span class="kn">import</span> <span class="n">fits</span>
<span class="kn">from</span> <span class="nn">astroquery.mast</span> <span class="kn">import</span> <span class="n">Observations</span>
<span class="kn">from</span> <span class="nn">drizzlepac</span> <span class="kn">import</span> <span class="n">tweakreg</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">photutils</span> <span class="kn">import</span> <span class="n">CircularAperture</span>
<span class="kn">import</span> <span class="nn">regions</span>
<span class="kn">from</span> <span class="nn">regions</span> <span class="kn">import</span> <span class="n">read_ds9</span>

<span class="c1"># set plotting details for notebooks</span>
<span class="o">%</span><span class="k">matplotlib</span> inline
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.figsize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The following task in the stsci.skypac package can be run with TEAL:
                                    skymatch                                    
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The following tasks in the drizzlepac package can be run with TEAL:
    astrodrizzle       config_testbed      imagefindpars           mapreg       
       photeq            pixreplace           pixtopix            pixtosky      
  refimagefindpars       resetbits          runastrodriz          skytopix      
     tweakback            tweakreg           updatenpol
</pre></div>
</div>
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ImportError</span><span class="g g-Whitespace">                               </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">line</span> <span class="mi">13</span>
<span class="g g-Whitespace">     </span><span class="mi">11</span> <span class="kn">from</span> <span class="nn">photutils</span> <span class="kn">import</span> <span class="n">CircularAperture</span>
<span class="g g-Whitespace">     </span><span class="mi">12</span> <span class="kn">import</span> <span class="nn">regions</span>
<span class="ne">---&gt; </span><span class="mi">13</span> <span class="kn">from</span> <span class="nn">regions</span> <span class="kn">import</span> <span class="n">read_ds9</span>
<span class="g g-Whitespace">     </span><span class="mi">15</span> <span class="c1"># set plotting details for notebooks</span>
<span class="g g-Whitespace">     </span><span class="mi">16</span> <span class="n">get_ipython</span><span class="p">()</span><span class="o">.</span><span class="n">run_line_magic</span><span class="p">(</span><span class="s1">&#39;matplotlib&#39;</span><span class="p">,</span> <span class="s1">&#39;inline&#39;</span><span class="p">)</span>

<span class="ne">ImportError</span>: cannot import name &#39;read_ds9&#39; from &#39;regions&#39; (/usr/share/miniconda/lib/python3.9/site-packages/regions/__init__.py)
</pre></div>
</div>
</div>
</div>
</section>
<section id="download-the-data">
<h2>1. Download the data<a class="headerlink" href="#download-the-data" title="Permalink to this headline">#</a></h2>
<p>This example uses observations of ‘MACSJ1149.5+2223-HFFPAR’ (<a class="reference external" href="http://www.stsci.edu/cgi-bin/get-proposal-info?id=13504&amp;observatory=HST">proposal ID 13504</a>, files <code class="docutils literal notranslate"><span class="pre">jcdua3f4q_flc.fits</span></code> and <code class="docutils literal notranslate"><span class="pre">jcdua3f8q_flc.fits</span></code>). We provide code below to retrieve the ACS/WFC calibrated FLC files.</p>
<p>Data are downloaded using the <code class="docutils literal notranslate"><span class="pre">astroquery</span></code> API to access the <a class="reference external" href="http://archive.stsci.edu/">MAST</a> archive. The <code class="docutils literal notranslate"><span class="pre">astroquery.mast</span></code> <a class="reference external" href="http://astroquery.readthedocs.io/en/latest/mast/mast.html">documentation</a> has more examples for how to find and download data from MAST.</p>
<p>It is unusual to download individual files instead of all the related files in an association, but it can be done. First, we need to find the IDs for these two specific FLC files.</p>
<p><strong>Note:</strong> <code class="docutils literal notranslate"><span class="pre">astroquery</span></code> uses both <code class="docutils literal notranslate"><span class="pre">obs_id</span></code> and <code class="docutils literal notranslate"><span class="pre">obsID</span></code>. Be careful not to confuse them.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Retrieve the observation information.</span>
<span class="n">obs_table</span> <span class="o">=</span> <span class="n">Observations</span><span class="o">.</span><span class="n">query_criteria</span><span class="p">(</span><span class="n">obs_id</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;JCDUA3010&#39;</span><span class="p">,</span><span class="s1">&#39;JCDUA3020&#39;</span><span class="p">])</span>

<span class="c1"># Find obsID for specific FLC images.</span>
<span class="n">product_list_by_association</span> <span class="o">=</span> <span class="n">Observations</span><span class="o">.</span><span class="n">get_product_list</span><span class="p">(</span><span class="n">obs_table</span><span class="p">[</span><span class="s1">&#39;obsid&#39;</span><span class="p">])</span>
<span class="n">product_list_by_association</span><span class="p">[</span><span class="s1">&#39;obsID&#39;</span><span class="p">,</span> <span class="s1">&#39;productFilename&#39;</span><span class="p">][</span><span class="mi">18</span><span class="p">:</span><span class="mi">28</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>Based on this table, the <code class="docutils literal notranslate"><span class="pre">obsID</span></code> values for <code class="docutils literal notranslate"><span class="pre">jcdua3f4q_flc.fits</span></code> and <code class="docutils literal notranslate"><span class="pre">jcdua3f8q_flc.fits</span></code> are 2003170978 and 2003170979. We use this information to download these two FITS files.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Download jcdua3f4q_flc.fits and jcdua3f8q_flc.fits from MAST. </span>
<span class="n">dataProductsByID</span> <span class="o">=</span> <span class="n">Observations</span><span class="o">.</span><span class="n">get_product_list</span><span class="p">([</span><span class="s1">&#39;2003170978&#39;</span><span class="p">,</span><span class="s1">&#39;2003170979&#39;</span><span class="p">])</span>
<span class="n">dataProductsByID</span> <span class="o">=</span> <span class="n">Observations</span><span class="o">.</span><span class="n">filter_products</span><span class="p">(</span><span class="n">dataProductsByID</span><span class="p">,</span> 
                                                <span class="n">productSubGroupDescription</span><span class="o">=</span><span class="s1">&#39;FLC&#39;</span><span class="p">)</span>
<span class="n">download_table</span> <span class="o">=</span> <span class="n">Observations</span><span class="o">.</span><span class="n">download_products</span><span class="p">(</span><span class="n">dataProductsByID</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><strong>If the cell above produces an error, try running it again.</strong> Connection issues can cause errors on the first try.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Move the files from the mastDownload directory to the current working directory.</span>
<span class="n">fits_files</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;mastDownload/HST/*/jcdua3f[48]q_flc.fits&#39;</span><span class="p">)</span> 
<span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">fits_files</span><span class="p">:</span>
    <span class="n">os</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">file</span><span class="p">))</span>
    
<span class="c1"># Delete the mastDownload directory and all subdirectories it contains.</span>
<span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="s1">&#39;mastDownload&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="use-tweakreg-to-create-source-catalogs">
<h2>2. Use TweakReg to create source catalogs<a class="headerlink" href="#use-tweakreg-to-create-source-catalogs" title="Permalink to this headline">#</a></h2>
<p>Run <code class="docutils literal notranslate"><span class="pre">TweakReg</span></code> on one of the FLC files downloaded into this directory, <code class="docutils literal notranslate"><span class="pre">jcdua3f4q_flc.fits</span></code>. By limiting the input list to one file <code class="docutils literal notranslate"><span class="pre">TweakReg</span></code> makes the source catalog for this image, but performs no matching or aligning. Using a slightly larger <code class="docutils literal notranslate"><span class="pre">conv_width</span></code> of 4.5 pixels (versus the default of 3.5 for ACS/WFC) means <code class="docutils literal notranslate"><span class="pre">TweakReg</span></code> will be able to utilize small compact objects for alignment.</p>
<p><strong>Note</strong>: This notebook is only concerned with the source detection capabilities of <code class="docutils literal notranslate"><span class="pre">TweakReg</span></code>, and so to prevent any changes being saved to the images, the <code class="docutils literal notranslate"><span class="pre">updatehdr</span></code> parameter is set to <strong>False</strong>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tweakreg</span><span class="o">.</span><span class="n">TweakReg</span><span class="p">(</span><span class="s1">&#39;jcdua3f4q_flc.fits&#39;</span><span class="p">,</span> 
                  <span class="n">imagefindcfg</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">threshold</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span><span class="n">conv_width</span><span class="o">=</span><span class="mf">4.5</span><span class="p">),</span>
                  <span class="n">updatehdr</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>This creates four output files:</p>
<ul class="simple">
<li><p><em>jcdua3f4q_flc_sci1_xy_catalog.coo</em> contains the X and Y positions, flux, and IDs for all detected sources in the SCI1 extention</p></li>
<li><p><em>jcdua3f4q_flc_sci2_xy_catalog.coo</em> contains the X and Y positions, flux, and IDs for all detected sources in the SCI2 extention</p></li>
<li><p><em>jcdua3f4q_flc_sky_catalog.coo</em> has the RA and DEC of all the sources from both extensions</p></li>
<li><p><em>tweakreg.log</em> is the log file output from <code class="docutils literal notranslate"><span class="pre">TweakReg</span></code></p></li>
</ul>
<p>Read in the the SCI1 catalog file.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Read in the SCI1 catalog file</span>
<span class="n">coords_tab</span> <span class="o">=</span> <span class="n">Table</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;jcdua3f4q_flc_sci1_xy_catalog.coo&#39;</span><span class="p">,</span> 
                        <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;ascii.no_header&#39;</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">,</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span><span class="s1">&#39;Flux&#39;</span><span class="p">,</span> <span class="s1">&#39;ID&#39;</span><span class="p">])</span>

<span class="c1"># Output the first five rows to display the table format</span>
<span class="n">coords_tab</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">5</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>Now read in the FITS image. This step will be used for demonstrative plots and is not necessary to run <code class="docutils literal notranslate"><span class="pre">TweakReg</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">hdulist</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;jcdua3f4q_flc.fits&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Then use <code class="docutils literal notranslate"><span class="pre">photutils</span></code> to generate apertures in order to display the source catalog positions detected by <code class="docutils literal notranslate"><span class="pre">TweakReg</span></code> on the FITS image. A fair number of spurious detections are found, but these are generally cosmic-rays which fall in random positions across the detector and will therefore not make it through into the matched catalogs (frame to frame).</p>
<p><strong>Note</strong>: This step may take a few seconds to run due to the large number of apertures plotted.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Make the apertures with photutils. </span>
<span class="c1"># One pixel offset corrects for differences between (0,0) and (1,1) origin systems. </span>
<span class="n">apertures</span> <span class="o">=</span> <span class="n">CircularAperture</span><span class="p">([</span><span class="n">coords_tab</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">]</span><span class="o">-</span><span class="mf">1.</span><span class="p">,</span> 
                              <span class="n">coords_tab</span><span class="p">[</span><span class="s1">&#39;Y&#39;</span><span class="p">]</span><span class="o">-</span><span class="mf">1.</span><span class="p">],</span> 
                              <span class="n">r</span><span class="o">=</span><span class="mf">10.</span><span class="p">)</span>

<span class="c1"># Plot a region of the image with pyplot</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">hdulist</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Greys&#39;</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">400</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">([</span><span class="mi">3200</span><span class="p">,</span><span class="mi">4000</span><span class="p">,</span><span class="mi">250</span><span class="p">,</span><span class="mi">1000</span><span class="p">])</span>

<span class="c1"># Overplot the apertures onto the image</span>
<span class="n">apertures</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="ds9-regions-in-tweakreg">
<h2>3. DS9 Regions in TweakReg<a class="headerlink" href="#ds9-regions-in-tweakreg" title="Permalink to this headline">#</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">TweakReg</span></code> allows the following DS9 regions: circle, ellipse, polygon, and box. All other regions are ignored. All region files must comply with the DS9 region file format and all regions must be provided in <em>image</em> coordinates.</p>
<p>This demonstration uses one of each type of shape possible. In the region file, they look like this (in image coordinates):</p>
<div class="highlight-ds9 notranslate"><div class="highlight"><pre><span></span>polygon(3702,845,3819,890,3804,797,3734,720,3671,745,3592,735,3602,770,3660,782)
ellipse(3512,809,26,67,0)
circle(3613,396,75)
box(3541,393,113,96,0)
</pre></div>
</div>
<p>Next the DS9 regions are read in and parsed with the <a class="reference external" href="https://astropy-regions.readthedocs.io/en/latest/getting_started.html">astropy regions package</a> and then added to the plot to show how they look on the image.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Read in and parse the DS9 region file with the regions package</span>
<span class="n">ds9_regions_file</span> <span class="o">=</span> <span class="s1">&#39;jcdua3f4q_sci1_exclude.reg&#39;</span>
<span class="n">regions</span> <span class="o">=</span> <span class="n">read_ds9</span><span class="p">(</span><span class="n">ds9_regions_file</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>

<span class="c1"># Plot previous figure with DS9 region shapes</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">hdulist</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> 
          <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Greys&#39;</span><span class="p">,</span> 
          <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> 
          <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">400</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">([</span><span class="mi">3200</span><span class="p">,</span><span class="mi">4000</span><span class="p">,</span><span class="mi">250</span><span class="p">,</span><span class="mi">1000</span><span class="p">])</span>
<span class="n">apertures</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.</span><span class="p">)</span>
<span class="k">for</span> <span class="n">regs</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
    <span class="n">regions</span><span class="p">[</span><span class="n">regs</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>You can see the polygon outlining a galaxy, including the extended tidal stream. The other shapes are placed randomly as demonstration.</p>
<p>This figure will be remade several times with different <code class="docutils literal notranslate"><span class="pre">TweakReg</span></code> outputs, so a function has been defined below to automatically read in the TweakReg source catalog and reproduce this figure.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define a function to remake this figure after subsequent TweakReg runs.</span>
<span class="k">def</span> <span class="nf">read_tweak_cat_and_plot</span><span class="p">():</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    This function reads in the TweakReg coordinate catalog for</span>
<span class="sd">    SCI1 of image JCDUA3F4Q, creates apertures for all the sources</span>
<span class="sd">    detected, then plots the apertures on the FITS image along</span>
<span class="sd">    with the DS9 region files defined previously in the notebook.&#39;&#39;&#39;</span>

    <span class="c1"># Read in the SCI1 catalog file with the exclusions</span>
    <span class="n">coords_tab</span> <span class="o">=</span> <span class="n">Table</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;jcdua3f4q_flc_sci1_xy_catalog.coo&#39;</span><span class="p">,</span> 
                            <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;ascii.no_header&#39;</span><span class="p">,</span> 
                            <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">,</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span><span class="s1">&#39;Flux&#39;</span><span class="p">,</span> <span class="s1">&#39;ID&#39;</span><span class="p">])</span>
    <span class="c1"># Define apertures for TweakReg identified sources</span>
    <span class="n">apertures</span> <span class="o">=</span> <span class="n">CircularAperture</span><span class="p">([</span><span class="n">coords_tab</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">]</span><span class="o">-</span><span class="mf">1.</span><span class="p">,</span> 
                                  <span class="n">coords_tab</span><span class="p">[</span><span class="s1">&#39;Y&#39;</span><span class="p">]</span><span class="o">-</span><span class="mf">1.</span><span class="p">],</span> 
                                  <span class="n">r</span><span class="o">=</span><span class="mf">10.</span><span class="p">)</span>
    <span class="c1"># Plot</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">hdulist</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Greys&#39;</span><span class="p">,</span> 
              <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">400</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">([</span><span class="mi">3200</span><span class="p">,</span><span class="mi">4000</span><span class="p">,</span><span class="mi">250</span><span class="p">,</span><span class="mi">1000</span><span class="p">])</span>
    <span class="n">apertures</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">regs</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
        <span class="n">regions</span><span class="p">[</span><span class="n">regs</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="exclusion-regions">
<h2>4. Exclusion regions<a class="headerlink" href="#exclusion-regions" title="Permalink to this headline">#</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">TweakReg</span></code> identifies the DS9 region files from a plain text file provided to the <code class="docutils literal notranslate"><span class="pre">exclusions</span></code> parameter. This text file must give the filename of the images and the name of the DS9 region files that should be applied to the SCI1 and SCI2 extensions, respectively. The format is important, and for our example would look like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">jcdua3f4q_flc</span><span class="o">.</span><span class="n">fits</span> <span class="n">jcdua3f4q_sci1_exclude</span><span class="o">.</span><span class="n">reg</span> <span class="kc">None</span>
<span class="n">jcdua3f8q_flc</span><span class="o">.</span><span class="n">fits</span> <span class="kc">None</span> <span class="kc">None</span>
</pre></div>
</div>
<p>‘None’ serves the function of an empty placeholder. Since the exclusions are applied only to SCI1, the syntax can be simplified to the following.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">jcdua3f4q_flc</span><span class="o">.</span><span class="n">fits</span> <span class="n">jcdua3f4q_sci1_exclude</span><span class="o">.</span><span class="n">reg</span>
<span class="n">jcdua3f8q_flc</span><span class="o">.</span><span class="n">fits</span>
</pre></div>
</div>
<p><strong>NOTE</strong>: If an image needs DS9 regions applied to the SCI2 extension only, then ‘None’ <strong>must</strong> be written after the filename and before the SCI2 region.</p>
<p>The git repo for this notebook contains a file <code class="docutils literal notranslate"><span class="pre">exclusions.txt</span></code> to use as input to <code class="docutils literal notranslate"><span class="pre">TweakReg</span></code>.</p>
<p>To exclude the sources within a DS9 region shape, a minus sign (-) is put before the shape. This time, all four shapes will be exluded from source detection. The corresponding DS9 region <code class="docutils literal notranslate"><span class="pre">jcdua3f4q_sci1_exclude.reg</span></code> therefore has the syntax:</p>
<div class="highlight-ds9 notranslate"><div class="highlight"><pre><span></span># Region file format: DS9 version 4.1
global color=yellow dashlist=8 3 width=2 font=&quot;helvetica 10 normal roman&quot; 
select=1 highlite=1 dash=0 fixed=0 edit=1 move=1 delete=1 include=1 source=1
image
-polygon(3702,845,3819,890,3804,797,3734,720,3671,745,3592,735,3602,770,3660,782)
-ellipse(3512,809,26,67,0)
-circle(3613,396,75)
-box(3541,393,113,96,0)
</pre></div>
</div>
<p>Now <code class="docutils literal notranslate"><span class="pre">TweakReg</span></code> is run again, this time with the DS9 regions provided by the <code class="docutils literal notranslate"><span class="pre">exclusions</span></code> parameter.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># tweakreg run with DS9 regions excluded from source detection</span>
<span class="n">tweakreg</span><span class="o">.</span><span class="n">TweakReg</span><span class="p">(</span><span class="s1">&#39;jcdua3f4q_flc.fits&#39;</span><span class="p">,</span> 
                  <span class="n">imagefindcfg</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">threshold</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span><span class="n">conv_width</span><span class="o">=</span><span class="mf">4.5</span><span class="p">),</span>
                  <span class="n">exclusions</span><span class="o">=</span><span class="s1">&#39;exclusions.txt&#39;</span><span class="p">,</span>
                  <span class="n">updatehdr</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">read_tweak_cat_and_plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>As expected, sources within the defined DS9 exlusion regions are no longer in the <code class="docutils literal notranslate"><span class="pre">TweakReg</span></code> source catalog.</p>
</section>
<section id="inclusion-regions">
<h2>5. Inclusion Regions<a class="headerlink" href="#inclusion-regions" title="Permalink to this headline">#</a></h2>
<p>Now we will look at inclusions, where only sources inside the DS9 regions are detected by <code class="docutils literal notranslate"><span class="pre">TweakReg</span></code>. The <code class="docutils literal notranslate"><span class="pre">exclusions</span></code> parameter name doesn’t change, but in this example we give it <code class="docutils literal notranslate"><span class="pre">inclusions.txt</span></code> now instead.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">jcdua3f4q_flc</span><span class="o">.</span><span class="n">fits</span> <span class="n">jcdua3f4q_sci1_include</span><span class="o">.</span><span class="n">reg</span>
<span class="n">jcdua3f8q_flc</span><span class="o">.</span><span class="n">fits</span>
</pre></div>
</div>
<p>From the information from the last section, the file syntax indicates that <code class="docutils literal notranslate"><span class="pre">jcdua3f4q_sci1_include.reg</span></code> is applied to the SCI1 extention of <code class="docutils literal notranslate"><span class="pre">jcdua3f4q_flc.fits</span></code>, and no DS9 regions are given for the SCI2 extention, or for the second image <code class="docutils literal notranslate"><span class="pre">jcdua3f8q_flc.fits</span></code>.</p>
<p>Looking at <code class="docutils literal notranslate"><span class="pre">jcdua3f4q_sci1_include.reg</span></code>, it shows the same shapes as before, but the minus signs (-) at the beginning of the lines are removed.</p>
<div class="highlight-ds9 notranslate"><div class="highlight"><pre><span></span># Region file format: DS9 version 4.1
global color=yellow dashlist=8 3 width=2 font=&quot;helvetica 10 normal roman&quot; 
select=1 highlite=1 dash=0 fixed=0 edit=1 move=1 delete=1 include=1 source=1
image
polygon(3702,845,3819,890,3804,797,3734,720,3671,745,3592,735,3602,770,3660,782)
ellipse(3512,809,26,67,0)
circle(3613,396,75)
box(3541,393,113,96,0)
</pre></div>
</div>
<p>There is no symbol associated with inclusion regions. If there is no symbol before the shape, then it is treated as an inclusion region. If there is a minus sign (-), then it is treated as an exclusion region.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># tweakreg run with source detection only inside the DS9 regions </span>
<span class="n">tweakreg</span><span class="o">.</span><span class="n">TweakReg</span><span class="p">(</span><span class="s1">&#39;jcdua3f4q_flc.fits&#39;</span><span class="p">,</span> 
                  <span class="n">imagefindcfg</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">threshold</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span><span class="n">conv_width</span><span class="o">=</span><span class="mf">4.5</span><span class="p">),</span>
                  <span class="n">exclusions</span><span class="o">=</span><span class="s1">&#39;inclusions.txt&#39;</span><span class="p">,</span>
                  <span class="n">updatehdr</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">read_tweak_cat_and_plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>This shows that only sources in the DS9 regions are included in the <code class="docutils literal notranslate"><span class="pre">TweakReg</span></code> source catalog. Note that only 63 objects were found by <code class="docutils literal notranslate"><span class="pre">TweakReg</span></code> for SCI1, compared to 10294 found in the original catalog. The number of objects for SCI2 is unchanged.</p>
</section>
<section id="combining-exclusion-and-inclusion-regions">
<h2>6. Combining Exclusion and Inclusion Regions<a class="headerlink" href="#combining-exclusion-and-inclusion-regions" title="Permalink to this headline">#</a></h2>
<p>The inclusion and exclusion regions can be used at the same time. For this example, the <code class="docutils literal notranslate"><span class="pre">inclusions_no_box.txt</span></code> file is fed to the exclusions parameter in <code class="docutils literal notranslate"><span class="pre">TweakReg</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">jcdua3f4q_flc</span><span class="o">.</span><span class="n">fits</span> <span class="n">jcdua3f4q_sci1_include_no_box</span><span class="o">.</span><span class="n">reg</span>
<span class="n">jcdua3f8q_flc</span><span class="o">.</span><span class="n">fits</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">jcdua3f4q_sci1_include_no_box.reg</span></code> has only a minus sign (-) on the last line.</p>
<div class="highlight-ds9 notranslate"><div class="highlight"><pre><span></span># Region file format: DS9 version 4.1
global color=yellow dashlist=8 3 width=2 font=&quot;helvetica 10 normal roman&quot; 
select=1 highlite=1 dash=0 fixed=0 edit=1 move=1 delete=1 include=1 source=1
image
polygon(3702,845,3819,890,3804,797,3734,720,3671,745,3592,735,3602,770,3660,782)
ellipse(3512,809,26,67,0)
circle(3613,396,75)
-box(3541,393,113,96,0)
</pre></div>
</div>
<p>This means that all the shapes will be treated as inclusion regions except for the box, which will be excluded from the source detection.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># tweakreg run with a mix of included/excluded DS9 regions</span>
<span class="n">tweakreg</span><span class="o">.</span><span class="n">TweakReg</span><span class="p">(</span><span class="s1">&#39;jcdua3f4q_flc.fits&#39;</span><span class="p">,</span> 
                  <span class="n">imagefindcfg</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">threshold</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span><span class="n">conv_width</span><span class="o">=</span><span class="mf">4.5</span><span class="p">),</span>
                  <span class="n">exclusions</span><span class="o">=</span><span class="s1">&#39;inclusions_no_box.txt&#39;</span><span class="p">,</span>
                  <span class="n">updatehdr</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">read_tweak_cat_and_plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>This shows the sources detected within the inclusion regions except for those excluded from the box.</p>
<p><strong>NOTE</strong>: The order of the DS9 regions is important!</p>
<p><code class="docutils literal notranslate"><span class="pre">TweakReg</span></code> applies the DS9 region requirements in the order in which they appear in the DS9 region file. To demonstrate this, the excluded box shape is moved to the beginning of the region list, so that it is the first processed instead of the last. This is seen by inputing <code class="docutils literal notranslate"><span class="pre">inclusions_no_box_first.txt</span></code> which specifies the region file <code class="docutils literal notranslate"><span class="pre">jcdua3f4q_sci1_include_no_box_first.reg</span></code>:</p>
<div class="highlight-ds9 notranslate"><div class="highlight"><pre><span></span># Region file format: DS9 version 4.1
global color=yellow dashlist=8 3 width=2 font=&quot;helvetica 10 normal roman&quot; 
select=1 highlite=1 dash=0 fixed=0 edit=1 move=1 delete=1 include=1 source=1
image
-box(3541,393,113,96,0)
polygon(3702,845,3819,890,3804,797,3734,720,3671,745,3592,735,3602,770,3660,782)
ellipse(3512,809,26,67,0)
circle(3613,396,75)
</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># tweakreg run with excluded box first to show order of operations</span>
<span class="n">tweakreg</span><span class="o">.</span><span class="n">TweakReg</span><span class="p">(</span><span class="s1">&#39;jcdua3f4q_flc.fits&#39;</span><span class="p">,</span> 
                  <span class="n">imagefindcfg</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">threshold</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span><span class="n">conv_width</span><span class="o">=</span><span class="mf">4.5</span><span class="p">),</span>
                  <span class="n">exclusions</span><span class="o">=</span><span class="s1">&#39;inclusions_no_box_first.txt&#39;</span><span class="p">,</span>
                  <span class="n">updatehdr</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">read_tweak_cat_and_plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Now the circle is given precedence because it is the last region shape processed, and therefore the section of overlap with the box is not removed as it was in the previous figure.</p>
<p>Due to this behavior, <strong>remember to be careful with the order in the DS9 region file when combining inclusion and exclusion requirements.</strong></p>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="about-this-notebook">
<h1>About this Notebook<a class="headerlink" href="#about-this-notebook" title="Permalink to this headline">#</a></h1>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Author: S. Hoffmann, STScI ACS Team  
Updated: December 14, 2018  
</pre></div>
</div>
<p><a class="reference external" href="#top">Top of Page</a></p>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "dulude/notebooks_migration",
            ref: "main",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./notebooks/DrizzlePac/use_ds9_regions_in_tweakreg"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By STScI<br/>
  
      &copy; Copyright 2022.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>